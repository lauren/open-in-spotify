/*! Open in Spotify JS v0.0.1 | Copyright 2013 Lauren Sperber https://github.com/lauren/pick-a-color/blob/master/LICENSE | save-to-spotify 2013-07-22 */
!function(a){a.selectors={Songza:function(){this.artist=document.getElementsByClassName("szi-artist")[0].innerHTML,this.track=document.getElementsByClassName("szi-song")[0].innerHTML,this.pauseButton=document.getElementsByClassName("szi-pause")[0],this.playButton=document.getElementsByClassName("szi-play")[0],this.currentlyPlaying=document.getElementsByClassName("szi-player-state-play").length>0},Pandora:function(){this.track=document.getElementsByClassName("songTitle")[0].innerHTML,this.artist=document.getElementsByClassName("artistSummary")[0].innerHTML,this.album=document.getElementsByClassName("albumTitle")[0].innerHTML,this.pauseButton=document.getElementsByClassName("pauseButton")[0],this.playButton=this.pauseButton,this.currentlyPlaying="block"===this.pauseButton.style.display},TurntableFM:function(){this.track=document.getElementsByClassName("songboard-title")[0].innerHTML,this.artist=document.getElementsByClassName("songboard-artist")[0].innerHTML,this.currentlyPlaying=!1},LastFM:function(){this.track=document.getElementsByClassName("track")[0].children[0].innerHTML,this.artist=document.getElementsByClassName("artist")[0].children[0].innerHTML,this.album=document.getElementsByClassName("title")[0].children[0].innerHTML,this.pauseButton=document.getElementById("radioControlPause").children[0],this.playButton=document.getElementById("radioControlPlay").children[0],this.currentlyPlaying=document.getElementsByClassName("playing").length>1}}}("undefined"==typeof exports?this:exports),function(a){var b=function(a){"Songza"===a?(this.pauseButton=document.getElementsByClassName("szi-pause")[0],this.playButton=document.getElementsByClassName("szi-play")[0],this.currentlyPlaying=document.getElementsByClassName("szi-player-state-play").length>0):"Pandora"===a?(this.pauseButton=document.getElementsByClassName("pauseButton")[0],this.playButton=this.pauseButton,this.currentlyPlaying="block"===this.pauseButton.style.display):"TurntableFM"===a?this.currentlyPlaying=!1:"LastFM"===a&&(this.pauseButton=document.getElementById("radioControlPause").children[0],this.playButton=document.getElementById("radioControlPlay").children[0],this.currentlyPlaying=document.getElementsByClassName("playing").length>1)};b.prototype.pause=function(){this.currentlyPlaying&&this.pauseButton.click()},b.prototype.play=function(){this.currentlyPlaying&&this.playButton.click()},a.musicController=b}("undefined"==typeof exports?this:exports),function(a){var b=function(){throw"Can't connect to Spotify."},c=function(a){var b=a.map(function(a){return a.name=a.name.replace(/[\.,-\/#!\$%\^&\*;:{}=\-_`~\(\)]/g,""),a.name=a.name.replace(/\s{2,}/g," "),a.album.name=a.album.name.replace(/[\.,-\/#!\$%\^&\*;:{}=\-_`~\(\)]/g,""),a.album.name=a.album.name.replace(/\s{2,}/g," "),a.artists=a.artists.map(function(a){return a.name=a.name.replace(/[\.,-\/#!\$%\^&\*;:{}=\-_`~\(\)]/g,""),a.name=a.name.replace(/\s{2,}/g," "),a}),a});return b},d=function(a,b){return b=b.replace(/[\.,-\/#!\$%\^&\*;:{}=\-_`~\(\)]/g,""),b=b.replace(/\s{2,}/g," "),a.filter(function(a){return e(a.artists,b)>-1})},e=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b.toLowerCase())return c;return-1},f=function(a){a=a.reverse();var b=a.filter(function(b,c){var d=a.slice(c+1,a.length);return!g(b,d)});return b.reverse()},g=function(a,b){for(var c=0;c<b.length;c++)if(a.name===b[c].name&&a.album.name===b[c].album.name)return!0;return!1},h={ajaxRequest:function(a,b,c){var d=new XMLHttpRequest;d.onload=b,d.onerror=c,d.open("get",a),d.send()},getTracks:function(a,e,g){var h="http://ws.spotify.com/search/1/track.json?q="+a.replace(/\s/g,"%20");this.ajaxRequest(h,function(){var a=JSON.parse(this.responseText),b=c(a.tracks),h=d(b,e),i=f(h);g(i)},b)},getArtists:function(a,c){var d="http://ws.spotify.com/search/1/artist.json?q="+a.replace(/\s/g,"%20");this.ajaxRequest(d,function(){var a=JSON.parse(this.responseText),b=a.artists;c(b)},b)}};a.spotifyQuerier=h}("undefined"==typeof exports?this:exports),function(a){var b={showTrackOptions:function(a){var b=d("large"),c=document.createElement("h2"),e=document.createElement("ul");c.innerHTML="Matching Tracks on Spotify",b.appendChild(c),a.map(function(a){var b=document.createElement("li"),c=a.artists[0];b.innerHTML="<a href='"+a.href+"'>"+a.name+"</a> by <a href='"+c.href+"'>"+c.name+"</a> from the album "+"<em><a href='"+a.album.href+"'></em>"+a.album.name+"</a>.",e.appendChild(b)}),b.appendChild(e),musicController.pause()},showArtistOptions:function(a){var b=d("large"),c=document.createElement("h2"),e=document.createElement("h3"),f=document.createElement("ul");e.innerHTML="<p>Sorry! I couldn't find the exact track you're listening to on Spotify.</p>",b.appendChild(e),c.innerHTML="Matching Artists on Spotify",b.appendChild(c),a.map(function(a){var b=document.createElement("li");b.innerHTML="<a href='"+a.href+"'>"+a.name+"</a>",f.appendChild(b)}),b.appendChild(f),musicController.pause()},showNotFoundMessage:function(a,b){var c=d("small"),e=document.createElement("h2"),f=document.createElement("h3");e.innerHTML="Not Found",c.appendChild(e),f.innerHTML="<p>Sorry, I couldn't find the track '"+a+"' or the artist '"+b+"' on Spotify.</p><p>Try again with the next song you like.</p>",c.appendChild(f),musicController.pause()},showUnsupportedSiteMessage:function(){var a=d("small"),b=document.createElement("h2"),c=document.createElement("h3");b.innerHTML="Site Not Supported",a.appendChild(b),c.innerHTML="<p>Sorry, I can't open songs from "+window.location.hostname+" in Spotify.</p>"+"<p>Try adding a song from <a href='http://songza.com'>Songza</a> or "+"<a href='http://last.fm'>Last.fm</a>.</p>",a.appendChild(c)},showWrongPageMessage:function(a){var b=d("small"),c=document.createElement("h2"),e=document.createElement("h3"),f=function(){return"Songza"===a?"Go to the <a href='http://songza.com'>Music Concierge</a> and select a station. ":"Pandora"===a?"Go to the <a href='http://pandora.com'>homepage</a> and search for an artist to create a radio station. ":"turntable.fm"===a?"Go to the <a href='http://turntable.fm'>homepage</a> and find a room to join. ":"last.fm"===a?"Go to the <a href='http://last.fm'>homepage</a> and find a station to listen to. ":"Go "};c.innerHTML="No Songs Detected",b.appendChild(c),e.innerHTML="<p>You're almost there!</p><p>"+f()+"Then you'll be able to open songs from "+a+" in Spotify.",b.appendChild(e)},showError:function(a){var b=d("small"),c=document.createElement("h2"),e=document.createElement("h3");c.innerHTML="Can't connect to Spotify",b.appendChild(c),e.innerHTML="<p>Sorry, I can't connect to Spotify right now.</p><p>Try again with the next song you like.</p>"+a.target.status,b.appendChild(e)},openInSpotify:function(a){musicController.pause(),window.location=a.href}},c=function(){document.body.removeChild(document.getElementById("add-to-spotify-overlay")),document.body.removeChild(document.getElementById("add-to-spotify-modal")),document.head.removeChild(document.getElementById("add-to-spotify-stylesheet")),document.body.style.overflow="auto",document.getElementsByTagName("html")[0].style.overflow="auto",musicController.play()},d=function(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.id="add-to-spotify-stylesheet",b.href="http://d39ywk3d3wha95.cloudfront.net/save-to-spotify.css",document.head.appendChild(b);var d=document.body.firstChild,f=document.createElement("div");f.id="add-to-spotify-modal",f.className="add-to-spotify-modal "+a;var g=document.createElement("div");g.id="close-spotify-modal",g.className="close-modal",g.innerHTML="&times;",f.appendChild(g);var h=document.createElement("div");h.id="add-to-spotify-modal-content",h.className="modal-content",f.appendChild(h),document.body.insertBefore(f,d),e(g,"click",function(){c()});var i=document.createElement("div");return i.id="add-to-spotify-overlay",i.className="add-to-spotify-overlay",i.style.height=parseInt(window.screen.height+20,10)+"px",document.body.style.overflow="hidden",document.getElementsByTagName("html")[0].style.overflow="hidden",document.body.insertBefore(i,f),h},e=function(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent(b,c)};a.render=b}("undefined"==typeof exports?this:exports),function(a){var b,c=function(a){this.siteInfo=a};switch(c.prototype.displayResults=function(){var a=this;try{spotifyQuerier.getTracks(this.siteInfo.track,this.siteInfo.artist,function(b){a.displayTracksOrArtists.call(a,b)})}catch(b){render.showError(b)}},c.prototype.displayTracksOrArtists=function(a){var b=this;0===a.length?spotifyQuerier.getArtists(this.siteInfo.artist,function(a){b.displayArtists.call(b,a)}):1===a.length?render.openInSpotify(a[0]):render.showTrackOptions(a)},c.prototype.displayArtists=function(a){0===a.length?render.showNotFoundMessage(this.siteInfo.track,this.siteInfo.artist):render.showArtistOptions(a)},window.location.hostname){case"songza.com":case"www.songza.com":try{var d=new selectors.Songza;musicController=new musicController("Songza")}catch(e){render.showWrongPageMessage("Songza")}new c(d).displayResults();break;case"turntable.fm":case"www.turntable.fm":try{var d=new selectors.TurntableFM;musicController=new musicController("TurntableFM")}catch(e){render.showWrongPageMessage("turntable.fm")}new c(d).displayResults();break;case"last.fm":case"www.last.fm":try{var d=new selectors.LastFM;musicController=new musicController("LastFM")}catch(e){render.showWrongPageMessage("last.fm")}new c(d).displayResults();break;case"pandora.com":case"www.pandora.com":try{var d=new selectors.Pandora;musicController=new musicController("Pandora")}catch(e){render.showWrongPageMessage("Pandora")}new c(d).displayResults();break;default:render.showUnsupportedSiteMessage()}a.thisMusicController=b}("undefined"==typeof exports?this:exports),function(a){var b=function(a){for(var b=[],c=0;c<this.length;c++)b.push(a(this[c]));return b},c=function(a){for(var b=[],c=0;c<this.length;c++)a(this[c],c,this)&&b.push(this);return b};void 0===Array.prototype.map&&(Array.prototype.map=b),void 0===Array.prototype.filter&&(Array.prototype.filter=c),a.shims={customFilter:c,customMap:b}}("undefined"==typeof exports?this:exports);