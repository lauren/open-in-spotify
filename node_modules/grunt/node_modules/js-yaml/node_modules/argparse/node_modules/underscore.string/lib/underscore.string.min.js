//  Underscore.string
//  (c) 2010 Esa-Matti Suuronen <esa-matti aet suuronen dot org>
//  Underscore.string is freely distributable under the terms of the MIT license.
//  Documentation: https://github.com/epeli/underscore.string
//  Some code is borrowed from MooTools and Alexandru Marasteanu.
//  Version '2.3.2'
!function(root,String){"use strict";function boolMatch(s,matchers){var i,matcher,down=s.toLowerCase();matchers=[].concat(matchers);for(i=0;i<matchers.length;i+=1){matcher=matchers[i];if(!matcher)continue;if(matcher.test&&matcher.test(s))return!0;if(matcher.toLowerCase()===down)return!0}}var nativeTrim=String.prototype.trim,nativeTrimRight=String.prototype.trimRight,nativeTrimLeft=String.prototype.trimLeft,parseNumber=function(source){return source*1||0},strRepeat=function(str,qty){if(qty<1)return"";var result="";while(qty>0)qty&1&&(result+=str),qty>>=1,str+=str;return result},slice=[].slice,defaultToWhiteSpace=function(characters){return characters==null?"\\s":characters.source?characters.source:"["+_s.escapeRegExp(characters)+"]"},escapeChars={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},reversedEscapeChars={};for(var key in escapeChars)reversedEscapeChars[escapeChars[key]]=key;reversedEscapeChars["'"]="#39";var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}var str_repeat=strRepeat,str_format=function(){return str_format.cache.hasOwnProperty(arguments[0])||(str_format.cache[arguments[0]]=str_format.parse(arguments[0])),str_format.format.call(null,str_format.cache[arguments[0]],arguments)};return str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string")output.push(parse_tree[i]);else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k]))throw new Error(sprintf('[_.sprintf] property "%s" does not exist',match[2][k]));arg=arg[match[2][k]]}}else match[1]?arg=argv[match[1]]:arg=argv[cursor++];if(/[^s]/.test(match[8])&&get_type(arg)!="number")throw new Error(sprintf("[_.sprintf] expecting number but found %s",get_type(arg)));switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase()}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg,pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ",pad_length=match[6]-String(arg).length,pad=match[6]?str_repeat(pad_character,pad_length):"",output.push(match[5]?arg+pad:pad+arg)}}return output.join("")},str_format.cache={},str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null)parse_tree.push(match[0]);else if((match=/^\x25{2}/.exec(_fmt))!==null)parse_tree.push("%");else{if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))===null)throw new Error("[_.sprintf] huh?");if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))===null)throw new Error("[_.sprintf] huh?");field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!=="")if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null)field_list.push(field_match[1]);else{if((field_match=/^\[(\d+)\]/.exec(replacement_field))===null)throw new Error("[_.sprintf] huh?");field_list.push(field_match[1])}match[2]=field_list}else arg_names|=2;if(arg_names===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");parse_tree.push(match)}_fmt=_fmt.substring(match[0].length)}return parse_tree},str_format}(),_s={VERSION:"2.3.0",isBlank:function(str){return str==null&&(str=""),/^\s*$/.test(str)},stripTags:function(str){return str==null?"":String(str).replace(/<\/?[^>]+>/g,"")},capitalize:function(str){return str=str==null?"":String(str),str.charAt(0).toUpperCase()+str.slice(1)},chop:function(str,step){return str==null?[]:(str=String(str),step=~~step,step>0?str.match(new RegExp(".{1,"+step+"}","g")):[str])},clean:function(str){return _s.strip(str).replace(/\s+/g," ")},count:function(str,substr){if(str==null||substr==null)return 0;str=String(str),substr=String(substr);var count=0,pos=0,length=substr.length;for(;;){pos=str.indexOf(substr,pos);if(pos===-1)break;count++,pos+=length}return count},chars:function(str){return str==null?[]:String(str).split("")},swapCase:function(str){return str==null?"":String(str).replace(/\S/g,function(c){return c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()})},escapeHTML:function(str){return str==null?"":String(str).replace(/[&<>"']/g,function(m){return"&"+reversedEscapeChars[m]+";"})},unescapeHTML:function(str){return str==null?"":String(str).replace(/\&([^;]+);/g,function(entity,entityCode){var match;return entityCode in escapeChars?escapeChars[entityCode]:(match=entityCode.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(match[1],16)):(match=entityCode.match(/^#(\d+)$/))?String.fromCharCode(~~match[1]):entity})},escapeRegExp:function(str){return str==null?"":String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(str,i,howmany,substr){var arr=_s.chars(str);return arr.splice(~~i,~~howmany,substr),arr.join("")},insert:function(str,i,substr){return _s.splice(str,i,0,substr)},include:function(str,needle){return needle===""?!0:str==null?!1:String(str).indexOf(needle)!==-1},join:function(){var args=slice.call(arguments),separator=args.shift();return separator==null&&(separator=""),args.join(separator)},lines:function(str){return str==null?[]:String(str).split("\n")},reverse:function(str){return _s.chars(str).reverse().join("")},startsWith:function(str,starts){return starts===""?!0:str==null||starts==null?!1:(str=String(str),starts=String(starts),str.length>=starts.length&&str.slice(0,starts.length)===starts)},endsWith:function(str,ends){return ends===""?!0:str==null||ends==null?!1:(str=String(str),ends=String(ends),str.length>=ends.length&&str.slice(str.length-ends.length)===ends)},succ:function(str){return str==null?"":(str=String(str),str.slice(0,-1)+String.fromCharCode(str.charCodeAt(str.length-1)+1))},titleize:function(str){return str==null?"":(str=String(str).toLowerCase(),str.replace(/(?:^|\s|-)\S/g,function(c){return c.toUpperCase()}))},camelize:function(str){return _s.trim(str).replace(/[-_\s]+(.)?/g,function(match,c){return c?c.toUpperCase():""})},underscored:function(str){return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(str){return _s.trim(str).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(str){return _s.titleize(String(str).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(str){return _s.capitalize(_s.underscored(str).replace(/_id$/,"").replace(/_/g," "))},trim:function(str,characters){return str==null?"":!characters&&nativeTrim?nativeTrim.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp("^"+characters+"+|"+characters+"+$","g"),""))},ltrim:function(str,characters){return str==null?"":!characters&&nativeTrimLeft?nativeTrimLeft.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp("^"+characters+"+"),""))},rtrim:function(str,characters){return str==null?"":!characters&&nativeTrimRight?nativeTrimRight.call(str):(characters=defaultToWhiteSpace(characters),String(str).replace(new RegExp(characters+"+$"),""))},truncate:function(str,length,truncateStr){return str==null?"":(str=String(str),truncateStr=truncateStr||"...",length=~~length,str.length>length?str.slice(0,length)+truncateStr:str)},prune:function(str,length,pruneStr){if(str==null)return"";str=String(str),length=~~length,pruneStr=pruneStr!=null?String(pruneStr):"...";if(str.length<=length)return str;var tmpl=function(c){return c.toUpperCase()!==c.toLowerCase()?"A":" "},template=str.slice(0,length+1).replace(/.(?=\W*\w*$)/g,tmpl);return template.slice(template.length-2).match(/\w\w/)?template=template.replace(/\s*\S+$/,""):template=_s.rtrim(template.slice(0,template.length-1)),(template+pruneStr).length>str.length?str:str.slice(0,template.length)+pruneStr},words:function(str,delimiter){return _s.isBlank(str)?[]:_s.trim(str,delimiter).split(delimiter||/\s+/)},pad:function(str,length,padStr,type){str=str==null?"":String(str),length=~~length;var padlen=0;padStr?padStr.length>1&&(padStr=padStr.charAt(0)):padStr=" ";switch(type){case"right":return padlen=length-str.length,str+strRepeat(padStr,padlen);case"both":return padlen=length-str.length,strRepeat(padStr,Math.ceil(padlen/2))+str+strRepeat(padStr,Math.floor(padlen/2));default:return padlen=length-str.length,strRepeat(padStr,padlen)+str}},lpad:function(str,length,padStr){return _s.pad(str,length,padStr)},rpad:function(str,length,padStr){return _s.pad(str,length,padStr,"right")},lrpad:function(str,length,padStr){return _s.pad(str,length,padStr,"both")},sprintf:sprintf,vsprintf:function(fmt,argv){return argv.unshift(fmt),sprintf.apply(null,argv)},toNumber:function(str,decimals){return str?(str=_s.trim(str),str.match(/^-?\d+(?:\.\d+)?$/)?parseNumber(parseNumber(str).toFixed(~~decimals)):NaN):0},numberFormat:function(number,dec,dsep,tsep){if(isNaN(number)||number==null)return"";number=number.toFixed(~~dec),tsep=typeof tsep=="string"?tsep:",";var parts=number.split("."),fnums=parts[0],decimals=parts[1]?(dsep||".")+parts[1]:"";return fnums.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+tsep)+decimals},strRight:function(str,sep){if(str==null)return"";str=String(str),sep=sep!=null?String(sep):sep;var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str},strRightBack:function(str,sep){if(str==null)return"";str=String(str),sep=sep!=null?String(sep):sep;var pos=sep?str.lastIndexOf(sep):-1;return~pos?str.slice(pos+sep.length,str.length):str},strLeft:function(str,sep){if(str==null)return"";str=String(str),sep=sep!=null?String(sep):sep;var pos=sep?str.indexOf(sep):-1;return~pos?str.slice(0,pos):str},strLeftBack:function(str,sep){if(str==null)return"";str+="",sep=sep!=null?""+sep:sep;var pos=str.lastIndexOf(sep);return~pos?str.slice(0,pos):str},toSentence:function(array,separator,lastSeparator,serial){separator=separator||", ",lastSeparator=lastSeparator||" and ";var a=array.slice(),lastMember=a.pop();return array.length>2&&serial&&(lastSeparator=_s.rtrim(separator)+lastSeparator),a.length?a.join(separator)+lastSeparator+lastMember:lastMember},toSentenceSerial:function(){var args=slice.call(arguments);return args[3]=!0,_s.toSentence.apply(_s,args)},slugify:function(str){if(str==null)return"";var from="ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",to="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",regex=new RegExp(defaultToWhiteSpace(from),"g");return str=String(str).toLowerCase().replace(regex,function(c){var index=from.indexOf(c);return to.charAt(index)||"-"}),_s.dasherize(str.replace(/[^\w\s-]/g,""))},surround:function(str,wrapper){return[wrapper,str,wrapper].join("")},quote:function(str,quoteChar){return _s.surround(str,quoteChar||'"')},unquote:function(str,quoteChar){return quoteChar=quoteChar||'"',str[0]===quoteChar&&str[str.length-1]===quoteChar?str.slice(1,str.length-1):str},exports:function(){var result={};for(var prop in this){if(!this.hasOwnProperty(prop)||prop.match(/^(?:include|contains|reverse)$/))continue;result[prop]=this[prop]}return result},repeat:function(str,qty,separator){if(str==null)return"";qty=~~qty;if(separator==null)return strRepeat(String(str),qty);for(var repeat=[];qty>0;repeat[--qty]=str);return repeat.join(separator)},naturalCmp:function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;var cmpRegex=/(\.\d+)|(\d+)|(\D+)/g,tokens1=String(str1).toLowerCase().match(cmpRegex),tokens2=String(str2).toLowerCase().match(cmpRegex),count=Math.min(tokens1.length,tokens2.length);for(var i=0;i<count;i++){var a=tokens1[i],b=tokens2[i];if(a!==b){var num1=parseInt(a,10);if(!isNaN(num1)){var num2=parseInt(b,10);if(!isNaN(num2)&&num1-num2)return num1-num2}return a<b?-1:1}}return tokens1.length===tokens2.length?tokens1.length-tokens2.length:str1<str2?-1:1},levenshtein:function(str1,str2){if(str1==null&&str2==null)return 0;if(str1==null)return String(str2).length;if(str2==null)return String(str1).length;str1=String(str1),str2=String(str2);var current=[],prev,value;for(var i=0;i<=str2.length;i++)for(var j=0;j<=str1.length;j++)i&&j?str1.charAt(j-1)===str2.charAt(i-1)?value=prev:value=Math.min(current[j],current[j-1],prev)+1:value=i+j,prev=current[j],current[j]=value;return current.pop()},toBoolean:function(str,trueValues,falseValues){typeof str=="number"&&(str=""+str);if(typeof str!="string")return!!str;str=_s.trim(str);if(boolMatch(str,trueValues||["true","1"]))return!0;if(boolMatch(str,falseValues||["false","0"]))return!1}};_s.strip=_s.trim,_s.lstrip=_s.ltrim,_s.rstrip=_s.rtrim,_s.center=_s.lrpad,_s.rjust=_s.lpad,_s.ljust=_s.rpad,_s.contains=_s.include,_s.q=_s.quote,_s.toBool=_s.toBoolean,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(module.exports=_s),exports._s=_s),typeof define=="function"&&define.amd&&define("underscore.string",[],function(){return _s}),root._=root._||{},root._.string=root._.str=_s}(this,String);