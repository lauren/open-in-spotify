function LinkWriter(props){var me=this;if(!(me instanceof LinkWriter))throw new Error("LinkWriter must be called as constructor.");if(!(props.type==="Link"&&props.Link||props.type==="SymbolicLink"&&props.SymbolicLink))throw new Error("Non-link type "+props.type);props.linkpath===""&&(props.linkpath="."),props.linkpath||me.error("Need linkpath property to create "+props.type),Writer.call(this,props)}function clobber(me,lp,link){rimraf(me._path,function(er){if(er)return me.error(er);create(me,lp,link)})}function create(me,lp,link){fs[link](lp,me._path,function(er){if(er){if(er.code!=="ENOENT"&&er.code!=="EACCES"&&er.code!=="EPERM"||process.platform!=="win32")return me.error(er);me.ready=!0,me.emit("ready"),me.emit("end"),me.emit("close"),me.end=me._finish=function(){}}finish(me)})}function finish(me){me.ready=!0,me.emit("ready"),me._ended&&!me._finished&&me._finish()}module.exports=LinkWriter;var fs=require("../../graceful-fs/graceful-fs.js"),Writer=require("./writer.js"),inherits=require("../../inherits/inherits.js"),path=require("path"),rimraf=require("../../rimraf/rimraf.js");inherits(LinkWriter,Writer),LinkWriter.prototype._create=function(){var me=this,hard=me.type==="Link"||process.platform==="win32",link=hard?"link":"symlink",lp=hard?path.resolve(me.dirname,me.linkpath):me.linkpath;if(hard)return clobber(me,lp,link);fs.readlink(me._path,function(er,p){if(p&&p===lp)return finish(me);clobber(me,lp,link)})},LinkWriter.prototype.end=function(){this._ended=!0,this.ready&&(this._finished=!0,this._finish())};