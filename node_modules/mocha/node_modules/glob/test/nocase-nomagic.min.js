var fs=require("graceful-fs"),test=require("tap").test,glob=require("../");test("mock fs",function(t){function fakeStat(path){var ret;switch(path.toLowerCase()){case"/tmp":case"/tmp/":ret={isDirectory:function(){return!0}};break;case"/tmp/a":ret={isDirectory:function(){return!1}}}return ret}function fakeReaddir(path){var ret;switch(path.toLowerCase()){case"/tmp":case"/tmp/":ret=["a","A"];break;case"/":ret=["tmp","tMp","tMP","TMP"]}return ret}var stat=fs.stat,statSync=fs.statSync,readdir=fs.readdir,readdirSync=fs.readdirSync;fs.stat=function(path,cb){var f=fakeStat(path);f?process.nextTick(function(){cb(null,f)}):stat.call(fs,path,cb)},fs.statSync=function(path){return fakeStat(path)||statSync.call(fs,path)},fs.readdir=function(path,cb){var f=fakeReaddir(path);f?process.nextTick(function(){cb(null,f)}):readdir.call(fs,path,cb)},fs.readdirSync=function(path){return fakeReaddir(path)||readdirSync.call(fs,path)},t.pass("mocked"),t.end()}),test("nocase, nomagic",function(t){var n=2,want=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/a",{nocase:!0},function(er,res){if(er)throw er;t.same(res.sort(),want),--n===0&&t.end()}),glob("/tmp/A",{nocase:!0},function(er,res){if(er)throw er;t.same(res.sort(),want),--n===0&&t.end()})}),test("nocase, with some magic",function(t){t.plan(2);var want=["/TMP/A","/TMP/a","/tMP/A","/tMP/a","/tMp/A","/tMp/a","/tmp/A","/tmp/a"];glob("/tmp/*",{nocase:!0},function(er,res){if(er)throw er;t.same(res.sort(),want)}),glob("/tmp/*",{nocase:!0},function(er,res){if(er)throw er;t.same(res.sort(),want)})});