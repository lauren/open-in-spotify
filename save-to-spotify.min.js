(function(){var e={htmlEl:document.getElementsByTagName("html")[0]},t=function(){var e=JSON.parse(this.responseText),t=u(e.tracks),n=a(t);n.length===0?d():n.length===1?window.location=n[0].href:p(n)},n=function(){var n=new XMLHttpRequest;n.onload=t,n.onerror=w,n.open("get","http://ws.spotify.com/search/1/track.json?q="+e.track.replace(/\s/g,"%20")),n.send()},r=function(){document.body.removeChild(document.getElementById("add-to-spotify-overlay")),document.body.removeChild(document.getElementById("add-to-spotify-modal")),document.body.style.overflow="auto",e.htmlEl.style.overflow="auto",b()},i=function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent(t,n)},s=function(t){var n=document.body.firstChild,s=document.createElement("div");s.id="add-to-spotify-modal",s.style.margin="auto auto",s.style.background="#fff",s.style.zIndex=1450,s.style.position="fixed",s.style.left="0",s.style.right="0",s.style.top="0",s.style.bottom="0",s.style.overflow="auto",s.style.width=t==="small"?"400px":"70%",s.style.height=t==="small"?"200px":"90%",s.style.borderRadius="5px";var o=document.createElement("div");o.id="close-spotify-modal",o.style.position="absolute",o.style.height="auto",o.style.width="auto",o.style.right="0",o.style.top="0",o.style.fontSize="40px",o.style.lineHeight="25px",o.style.padding="10px",o.style.borderLeft="1px solid #666",o.style.borderBottom="1px solid #666",o.style.borderRight="1px solid #666",o.style.cursor="pointer",o.innerHTML="&times;",s.appendChild(o);var u=document.createElement("div");u.id="add-to-spotify-modal-content",u.style.padding="15px",s.appendChild(u),document.body.insertBefore(s,n),i(o,"click",r);var a=document.createElement("div");return a.id="add-to-spotify-overlay",a.style.background="#000",a.style.opacity=.7,a.style.zIndex=1400,a.style.height=parseInt(window.screen.height+20,10)+"px",a.style.width="100%",a.style.marginTop="-15px",a.style.position="absolute",document.body.style.overflow="hidden",e.htmlEl.style.overflow="hidden",document.body.insertBefore(a,s),u},o=function(){var e=s("small"),t=document.createElement("h2"),n=document.createElement("h3");t.innerHTML="Site Not Supported",e.appendChild(t),n.innerHTML="<p>Sorry, I can't save to spotify from "+window.location.hostname+".</p>"+"<p>Try adding a song from Songza, Pandora, or Turntable.fm.</p>",e.appendChild(n)};(function(){switch(window.location.hostname){case"songza.com":e.artist=document.getElementsByClassName("szi-artist")[0].innerHTML,e.track=document.getElementsByClassName("szi-song")[0].innerHTML,e.pauseButton=document.getElementsByClassName("szi-pause")[0],e.currentlyPlaying=document.getElementsByClassName("szi-player-state-play").length>0,n();break;default:o()}})();var u=function(t){return t.filter(function(t){return c(t.artists,e.artist)>-1})},a=function(e){var e=f(e.reverse()),t=e.filter(function(t,n){var r=e.slice(n+1,e.length);return!l(t,r)});return t.reverse()},f=function(e){return e.map(function(e){return e.name=e.name.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,""),e.name=e.name.replace(/\s{2,}/g," "),e.album.name=e.album.name.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,""),e.album.name=e.album.name.replace(/\s{2,}/g," "),e})},l=function(e,t){for(var n=0;n<t.length;n++)if(e.name===t[n].name&&e.album.name===t[n].album.name)return!0;return!1},c=function(e,t){for(var n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.toLowerCase())return n;return-1},h=function(){var e=document.createElement("ul");return e.style.fontSize="20px",e},p=function(e){var t=s("large"),n=document.createElement("h2"),r=h();n.innerHTML="Matching Tracks on Spotify",t.appendChild(n),e.map(function(e){var t=document.createElement("li"),n=e.artists[0];t.innerHTML="<a href='"+e.href+"'>"+e.name+"</a> by <a href='"+n.href+"'>"+n.name+"</a> from the album "+"<em><a href='"+e.album.href+"'></em>"+e.album.name+"</a>.",r.appendChild(t)}),t.appendChild(r),y()},d=function(){var t=new XMLHttpRequest;t.onload=v,t.onerror=w,t.open("get","http://ws.spotify.com/search/1/artist.json?q="+e.artist.replace(/\s/g,"%20")),t.send()},v=function(){var e=JSON.parse(this.responseText),t=e.info.num_results;t===0?g():m(e.artists)},m=function(e){var t=s("large"),n=document.createElement("h2"),r=document.createElement("h3"),i=h();r.innerHTML="<p>Sorry! I couldn't find the exact track you're listening to on Spotify.</p>",t.appendChild(r),n.innerHTML="Matching Artists on Spotify",t.appendChild(n),e.map(function(e){var t=document.createElement("li");t.innerHTML="<a href='"+e.href+"'>"+e.name+"</a>",i.appendChild(t)}),t.appendChild(i),y()},g=function(){var t=s("small"),n=document.createElement("h2"),r=document.createElement("h3");n.innerHTML="Not Found",t.appendChild(n),r.innerHTML="<p>Sorry, I couldn't find the track '"+e.track+"' or the artist "+e.artist+" on Spotify.</p><p>Try again with the next song you like.</p>",t.appendChild(r)},y=function(){e.currentlyPlaying&&e.pauseButton.click()},b=function(){e.currentlyPlaying&&e.pauseButton.click()},w=function(e){var t=s("small"),n=document.createElement("h2"),r=document.createElement("h3");n.innerHTML="Can't connect to Spotify",t.appendChild(n),r.innerHTML="<p>Sorry, I can't connect to Spotify right now.</p><p>Try again with the next song you like.</p>"+e.target.status,t.appendChild(r)};Array.prototype.map===undefined&&(Array.prototype.map=function(e){var t=[];for(var n=0;n<this.length;n++)t.push(e(this[n]));return t}),Array.prototype.filter===undefined&&(Array.prototype.filter=function(e){var t=[];for(var n=0;n<this.length;n++)e(this[n],n,this)&&t.push(this);return t})})();